<div ng-init="setPerm(['KOORD','TRENER','STAFF'])"></div>
<div class="section paymentSection" ng-init="initPaymentHistory()">
    <div ng-show='showContent' class="row">
        <div class="col s12">
            <div class="card">
                <div class="card-content" style='padding-bottom: 0 !important;'>
                    <div class="row" style="padding-top:20px;">
                        <div class="input-field col s12" >
                            <select id="selectUserToGetHistory">
                                <option value="" disabled selected>Wybierz użytkownika</option>
                                <option ng-repeat="user in allUsers" value="{{user.usid}}">{{user.firstname}} {{user.lastname}}</option>
                            </select>
                            <label>Płatności dla użytkownika</label>
                        </div>
                        <div class="input-field col s12 m8 offset-m2" ng-hide="selectedUserHistory.length <= 0">
                            <input id='changeFilter' type="text" placeholder='Wpisz szukaną frazę' ng-model='searchText'>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col s12" ng-show="!userIsSelected">
            <h5 style="text-align: center;color: #a1a1a1; margin-top: 50px">Wybierz użytkownika</h5>
        </div>
        <div class="col s12" ng-show="selectedUserHistory.length <= 0 && userIsSelected">
            <h5 style="text-align: center;color: #a1a1a1; margin-top: 50px">Niestety dany użytkownik nie ma żadnych wystawionych płatności.</h5>
        </div>
        <div class="col s12" ng-hide="selectedUserHistory.length <= 0">
            <div class="card">
                <div class="card-content">
                    <div class="card-title">Lista płatności</div>
                    <div class="row">
                        <table class='table centered highlight striped'>
                            <thead>
                                <tr>
                                    <th>Tytuł</th>
                                    <th>Kwota</th>
                                    <th>Do kiedy</th>
                                    <th>Status</th>
                                    <th>Akcje</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="userHis in selectedUserHistory | filter:searchText track by $index">
                                    <td>{{userHis.name}}</td>
                                    <td><b>{{userHis.amount}} zł</b></td>
                                    <td class="paymentDateToPay">{{userHis.date_to_pay}}</td>
                                    <td class="paymentStatus">{{userHis.statusName}}</td>
                                    <td>
                                        <span style='cursor: pointer; padding: 10px;' ng-click="endPayment(userHis.id)"><i class="fa fa-check fa-fw" aria-hidden="true"></i></span>
                                        <span style='cursor: pointer; padding: 10px;' ng-click="deletePayment(userHis.id)"><i class="fa fa-trash fa-fw" aria-hidden="true"></i></span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div ng-hide='showContent' class='loaderContainer'>
        <div id="loader-wrapper">
            <div id="loader"></div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        setTimeout(function() {
            Materialize.updateTextFields();
            $('select').material_select();
            $('ul.tabs').tabs();
            $('.collapsible').collapsible();
            $('.datetimepicker').datetimepicker({
                format: 'Y/m/d',
                lang: 'pl',
                timepicker: false,
            });
        }, 500);
    });
</script>